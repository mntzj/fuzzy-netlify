---
title: "Catch em All"
author: "mntzj"
date: '2021-09-18'
excerpt: ''
layout: single
series: null
slug: []
subtitle: ''
tags:
- pokemon
- api
- json
- purrr
categories: []
---



<p>In this post, we are going to go into the pokemon world and try to catch some
through the API <a href="https://pokeapi.co/">pokeapi.co</a>. A fun way to get familiar with
working with APIs and handling JSON response with nested lists into tidy and nice rectangles of data.
<img src="https://lh3.googleusercontent.com/proxy/J6QEl0JbwBX1zPstq2W3OWk7iVdRGZHXWcfdboF2oNdpHtxEIkrdTwUbyvJneyzmppyTCK5hAIGUWKyeQAeBKW0I9i0EJTVInuca0_O9jPocZEVqJ5Cywk59bDhjU-d42UTxL7IP7UbPi7Qb__T322Uh96bOpGwDYfI" alt="Hehe" /></p>
<p><em>note that in this example no authentication is required to access this API, and all resources are fully open and available</em> ..</p>
<pre class="r"><code>library(httr, quietly = TRUE, warn.conflicts = FALSE)
library(jsonlite, quietly = TRUE, warn.conflicts = FALSE)
library(tidyverse, quietly = TRUE, warn.conflicts = FALSE)</code></pre>
<pre><code>## Registered S3 methods overwritten by &#39;tibble&#39;:
##   method     from  
##   format.tbl pillar
##   print.tbl  pillar</code></pre>
<pre><code>## ── Attaching packages ────────────────────────────────────────────────────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✓ ggplot2 3.2.1     ✓ purrr   0.3.4
## ✓ tibble  3.0.1     ✓ dplyr   1.0.7
## ✓ tidyr   1.0.0     ✓ stringr 1.4.0
## ✓ readr   1.3.1     ✓ forcats 0.5.0</code></pre>
<pre><code>## ── Conflicts ───────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter()  masks stats::filter()
## x purrr::flatten() masks jsonlite::flatten()
## x dplyr::lag()     masks stats::lag()</code></pre>
<pre class="r"><code>poke_base &lt;- &quot;https://pokeapi.co/api/v2/&quot;
pokemon_endpoint &lt;- &quot;pokemon&quot;
records_limit &lt;- &quot;/?limit=200&quot;
call &lt;- paste0(poke_base,pokemon_endpoint,records_limit)</code></pre>
<pre class="r"><code>catch_em_all &lt;- httr::GET(url = call)
catch_em_all$status_code</code></pre>
<pre><code>## [1] 200</code></pre>
<pre class="r"><code>response_content &lt;- httr::content(catch_em_all, as = &quot;text&quot;)</code></pre>
<pre class="r"><code>pokemons_json &lt;- jsonlite::fromJSON(response_content, flatten = TRUE)
pokemons_tibble &lt;- as_tibble(pokemons_json$results)</code></pre>
<pre class="r"><code>catch_pokemon &lt;- function(pokemon, poketable=pokemons_tibble)
{
  .poke_url = poketable[match(pokemon, poketable$name), 2] %&gt;% pull()
  .catch = httr::GET(url = .poke_url)
  .content = httr::content(.catch, as = &quot;text&quot;)
  return(jsonlite::fromJSON(.content, flatten = TRUE))
}

catch_pokemon(&quot;charmander&quot;) %&gt;% str(max.level = 1)</code></pre>
<pre><code>## List of 18
##  $ abilities               :&#39;data.frame&#39;:    2 obs. of  4 variables:
##  $ base_experience         : int 62
##  $ forms                   :&#39;data.frame&#39;:    1 obs. of  2 variables:
##  $ game_indices            :&#39;data.frame&#39;:    20 obs. of  3 variables:
##  $ height                  : int 6
##  $ held_items              : list()
##  $ id                      : int 4
##  $ is_default              : logi TRUE
##  $ location_area_encounters: chr &quot;https://pokeapi.co/api/v2/pokemon/4/encounters&quot;
##  $ moves                   :&#39;data.frame&#39;:    93 obs. of  3 variables:
##  $ name                    : chr &quot;charmander&quot;
##  $ order                   : int 5
##  $ past_types              : list()
##  $ species                 :List of 2
##  $ sprites                 :List of 10
##  $ stats                   :&#39;data.frame&#39;:    6 obs. of  4 variables:
##  $ types                   :&#39;data.frame&#39;:    1 obs. of  3 variables:
##  $ weight                  : int 85</code></pre>
<pre class="r"><code>pokenets &lt;- map(pokemons_tibble$name, catch_pokemon)
names(pokenets) &lt;- pokemons_tibble$name
#These are our pokemons</code></pre>
<pre><code>## List of 200
##  $ bulbasaur :List of 18
##  $ ivysaur   :List of 18
##  $ venusaur  :List of 18
##  $ charmander:List of 18
##  $ charmeleon:List of 18
##  $ charizard :List of 18
##  $ squirtle  :List of 18
##  $ wartortle :List of 18
##  $ blastoise :List of 18
##  $ caterpie  :List of 18
##  $ metapod   :List of 18
##  $ butterfree:List of 18
##  $ weedle    :List of 18
##  $ kakuna    :List of 18
##  $ beedrill  :List of 18
##  $ pidgey    :List of 18
##  $ pidgeotto :List of 18
##  $ pidgeot   :List of 18
##  $ rattata   :List of 18
##  $ raticate  :List of 18
##  $ spearow   :List of 18
##  $ fearow    :List of 18
##  $ ekans     :List of 18
##  $ arbok     :List of 18
##  $ pikachu   :List of 18
##  $ raichu    :List of 18
##  $ sandshrew :List of 18
##  $ sandslash :List of 18
##  $ nidoran-f :List of 18
##  $ nidorina  :List of 18
##  $ nidoqueen :List of 18
##  $ nidoran-m :List of 18
##  $ nidorino  :List of 18
##  $ nidoking  :List of 18
##  $ clefairy  :List of 18
##  $ clefable  :List of 18
##  $ vulpix    :List of 18
##  $ ninetales :List of 18
##  $ jigglypuff:List of 18
##  $ wigglytuff:List of 18
##  $ zubat     :List of 18
##  $ golbat    :List of 18
##  $ oddish    :List of 18
##  $ gloom     :List of 18
##  $ vileplume :List of 18
##  $ paras     :List of 18
##  $ parasect  :List of 18
##  $ venonat   :List of 18
##  $ venomoth  :List of 18
##  $ diglett   :List of 18
##  $ dugtrio   :List of 18
##  $ meowth    :List of 18
##  $ persian   :List of 18
##  $ psyduck   :List of 18
##  $ golduck   :List of 18
##  $ mankey    :List of 18
##  $ primeape  :List of 18
##  $ growlithe :List of 18
##  $ arcanine  :List of 18
##  $ poliwag   :List of 18
##  $ poliwhirl :List of 18
##  $ poliwrath :List of 18
##  $ abra      :List of 18
##  $ kadabra   :List of 18
##  $ alakazam  :List of 18
##  $ machop    :List of 18
##  $ machoke   :List of 18
##  $ machamp   :List of 18
##  $ bellsprout:List of 18
##  $ weepinbell:List of 18
##  $ victreebel:List of 18
##  $ tentacool :List of 18
##  $ tentacruel:List of 18
##  $ geodude   :List of 18
##  $ graveler  :List of 18
##  $ golem     :List of 18
##  $ ponyta    :List of 18
##  $ rapidash  :List of 18
##  $ slowpoke  :List of 18
##  $ slowbro   :List of 18
##  $ magnemite :List of 18
##  $ magneton  :List of 18
##  $ farfetchd :List of 18
##  $ doduo     :List of 18
##  $ dodrio    :List of 18
##  $ seel      :List of 18
##  $ dewgong   :List of 18
##  $ grimer    :List of 18
##  $ muk       :List of 18
##  $ shellder  :List of 18
##  $ cloyster  :List of 18
##  $ gastly    :List of 18
##  $ haunter   :List of 18
##  $ gengar    :List of 18
##  $ onix      :List of 18
##  $ drowzee   :List of 18
##  $ hypno     :List of 18
##  $ krabby    :List of 18
##  $ kingler   :List of 18
##   [list output truncated]</code></pre>
<pre class="r"><code>library(corrr)

pokenets_tbl %&gt;%
  select(height:speed) %&gt;%
  correlate() %&gt;%
  rearrange() %&gt;%
  shave() %&gt;%
  rplot(shape = 15, colours = c(&quot;darkorange&quot;, &quot;white&quot;, &quot;darkcyan&quot;))</code></pre>
<pre><code>## 
## Correlation method: &#39;pearson&#39;
## Missing treated using: &#39;pairwise.complete.obs&#39;</code></pre>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type noquote. Defaulting to continuous.</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>#todo : perform PCA and or Lin Reg</p>
